import{j as e}from"./vendor-markdown-Dek94WS0.js";import{r as v}from"./vendor-react-V04_Axys.js";import{r as Me,g as Le,a as Se,m as De,i as Ie}from"./workflowChat-BLNQv2K6.js";import{a as Y}from"./message-components-CQULTycO.js";import"./input.js";import"./App-B9oS-EBv.js";function $e(u,f){try{if(!u)return console.error("Invalid prompt_output: ",u),u;for(const p of f){if(!u[p.nodeId]){console.error(`Node with ID ${p.nodeId} not found`);continue}if(!u[p.nodeId].inputs){console.error(`Inputs not found for node with ID ${p.nodeId}`);continue}for(const w of p.params)u[p.nodeId].inputs[w.paramName]=w.paramValue}return u}catch(p){return console.error("Error updating prompt:",p),u}}async function Ve(u){const f=await Y.graphToPrompt(),p=$e(f.output,u);console.log("queuePrompt updated_prompt:",p);const w={prompt:p,client_id:Y.api.clientId,extra_data:{extra_pageinfo:{workflow:f.workflow}}};console.debug("queuePrompt request_body.prompt:",p);const b=await Me(w);return console.debug("queuePrompt response:",b),b}function ie(u){const f=document.createElement("canvas"),p=f.getContext("2d"),w=512,b=512;return f.width=w,f.height=b,p&&(p.fillStyle="red",p.font="20px Arial",p.fillText(u,10,30)),new Blob([f.toDataURL("image/png")],{type:"image/png"})}async function Te(u){try{if(!u||u==="")return console.log("No prompt ID provided"),{1:[ie("Fail to generate prompt ID")]};const f=await Le(u);if(!f||!f[u])return console.log("Not finished for prompt ID:",u),{};const p=f[u];if(p.status&&p.status.status_str==="error"){console.error("Error for prompt ID:",u);const b=p.status.messages;if(b&&b.length>0){const S=b[b.length-1];if(S&&S.length>0){const V=S[0];return{1:[ie(V)]}}}}const w={};if(p.outputs)for(const b in p.outputs){const S=p.outputs[b];if(S.images){const V=[];for(const P of S.images){const R=await Se(P.filename,P.subfolder,P.type);V.push(R)}w[b]=V}}return w}catch(f){throw console.error("Error getting output images from prompt:",f),f}}async function Be(u){const f=await Te(u);if(Object.keys(f).length===0)return[];const p=Object.keys(f).map(b=>parseInt(b)),w=Math.max(...p).toString();return f[w]||[]}const Oe=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,_e=({selectedNodes:u,visible:f})=>{const[p,w]=v.useState(0),[b,S]=v.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[V,P]=v.useState(!1),[R,K]=v.useState(!1),[J,Z]=v.useState(0),[D,ce]=v.useState(12),[T,de]=v.useState(null),[B,ee]=v.useState(()=>Array(12).fill(null).map((t,a)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:a%3===0?5:a%3===1?10:15,sampler_name:"euler",cfg:1}}))),[h,te]=v.useState({}),[I,se]=v.useState({}),[$,xe]=v.useState({});v.useState({});const[me,F]=v.useState({}),[k,Q]=v.useState(1),A=6,[_,O]=v.useState(null),[ue,re]=v.useState(!1),[pe,ae]=v.useState(!1),[he,ge]=v.useState("");v.useEffect(()=>{const t=document.createElement("style");return t.textContent=Oe,document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]),v.useEffect(()=>{const t=a=>{if(Object.values(I).some(o=>o)){const o=a.target,n=!!o.closest(".dropdown-menu"),s=!!o.closest("[data-dropdown]");!n&&!s&&se({})}};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[I]);const fe=Math.ceil(D/A),U=(t,a)=>{a&&(a.preventDefault(),a.stopPropagation()),Q(Math.max(1,Math.min(t,fe)))},ne=t=>{t&&(t.preventDefault(),t.stopPropagation()),p===1&&ce(je()),O(null),w(a=>Math.min(a+1,2))},G=t=>{t&&(t.preventDefault(),t.stopPropagation()),O(null),R&&K(!1),w(a=>Math.max(a-1,0))},be=(t,a)=>{a&&(a.preventDefault(),a.stopPropagation()),S(o=>({...o,[t]:!o[t]}))},H=(t,a,o,n=0)=>{t=isNaN(t)?0:t,a=isNaN(a)?100:a,o=isNaN(o)||o<=0?1:o,a<t&&(a=t);const s=Math.floor((a-t)/o)+1;if(s<=1)return[t];const l=[];let i=t;if(s<=10)for(;i<=a&&l.length<=10;){const r=Math.pow(10,n),c=Math.round(i*r)/r;l.push(c),i+=o}else{const c=(a-t)/9;for(let x=0;x<=9;x++){const m=t+c*x,d=Math.pow(10,n),N=Math.round(m*d)/d;l.push(N)}}return l},je=t=>X().length,X=()=>{const t=[],a=()=>{const n={};Object.keys(h).forEach(s=>{n[s]=[],Object.entries(h[s]||{}).forEach(([l,i])=>{if(!i||i.length===0)return;const r=[];i.forEach(c=>{const x={};x[l]=c,r.push(x)}),n[s].push(r)})}),Object.entries(n).forEach(([s,l])=>{if(l.length===0)return;o(l).forEach(r=>{const c=[];Object.entries(r).forEach(([x,m])=>{c.push({paramName:x,paramValue:String(m)})}),t.push({nodeId:parseInt(s),params:c})})})},o=n=>{if(n.length===0)return[{}];let s=n[0].map(l=>({...l}));for(let l=1;l<n.length;l++){const i=[];for(const r of s)for(const c of n[l])i.push({...r,...c});s=i}return s};return a(),t},ve=(t,a,o)=>{o.preventDefault(),o.stopPropagation();const n=`${t}_${a}`;se(s=>{if(s[n]&&typeof s[n]=="object"?s[n].isOpen:!!s[n])return{...s,[n]:!1};{let i=0,r=0;if(o.currentTarget){const m=o.currentTarget.getBoundingClientRect();i=m.left,r=m.bottom}else i=o.clientX,r=o.clientY+20;const c=window.innerWidth,x=250;return i+x>c&&(i=c-x-10),i<0&&(i=10),{...s,[n]:{isOpen:!0,x:i,y:r}}}})},M=(t,a,o)=>{te(n=>{const s={...n};return s[t]||(s[t]={}),s[t][a]=o,s})},q=(t,a,o,n)=>{n&&(n.preventDefault(),n.stopPropagation()),te(s=>{const l={...s};l[t]||(l[t]={}),l[t][a]||(l[t][a]=[]);const i=l[t][a];return i.includes(o)?l[t][a]=i.filter(r=>r!==o):l[t][a]=[...i,o],l})},ye=(t,a,o)=>{const n=`${t}_${a}`;xe(s=>({...s,[n]:o}))},we=(t,a,o)=>{if(!h[t]){M(t,a,o);return}const n=h[t][a]||[];o.length===n.length?M(t,a,[]):M(t,a,[...o])},Ne=(t,a)=>{const o={};o.nodeParams={};const n=X();if(a<n.length){const s=n[a];o.nodeParams[s.nodeId]={},s.params.forEach(l=>{o.nodeParams[s.nodeId][l.paramName]=l.paramValue,o[l.paramName]=l.paramValue})}return o},oe=async t=>{if(t&&(t.preventDefault(),t.stopPropagation()),D>20){O(`Cannot generate more than 20 images at once (currently: ${D} images)`);return}O(null),P(!0),Z(0);const a=X();if(console.log("Generated parameter combinations:",a),a.length===0){O("No valid parameter combinations found. Please check your parameter selections."),P(!1);return}const o=[];try{for(const r of a){const c=await Ve([r]);c.prompt_id?o.push(c.prompt_id):(console.error("Failed to get prompt_id from response:",c),o.push(""))}const n=Array(a.length).fill(null).map((r,c)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:Ne(h,c)}));ee(n);const s=Date.now(),l=5*60*1e3,i=async()=>{if(Date.now()-s>l){console.log("Timeout reached while waiting for images"),P(!1),K(!0),Q(1);return}let r=0;for(let c=0;c<o.length;c++){const x=o[c];if(x)try{const m=await Be(x);if(m&&m.length>0){const d=URL.createObjectURL(m[0]);n[c]={...n[c],url:d},r++}}catch(m){console.error(`Error fetching image for prompt ID ${x}:`,m)}}ee([...n]),Z(r),r===o.length||Date.now()-s>l?(P(!1),K(!0),Q(1)):setTimeout(i,3e3)};i()}catch(n){console.error("Error generating images:",n),P(!1)}},ke=(t,a)=>{a&&(a.preventDefault(),a.stopPropagation()),de(t)},Ce=(t,a)=>{a.preventDefault(),a.stopPropagation(),ge(t),ae(!0)},le=t=>{t&&(t.preventDefault(),t.stopPropagation()),ae(!1)},Pe=t=>{if(t&&(t.preventDefault(),t.stopPropagation()),T!==null){console.log(`Applied image ${T+1} with parameters:`,B[T].params);const a=B[T].params;a.nodeParams&&(Object.entries(a.nodeParams).forEach(([o,n])=>{const s=Y.graph._nodes_by_id[o];!s||!s.widgets||Object.entries(n).forEach(([l,i])=>{for(const r of s.widgets)if(r.name===l){r.value=i;break}})}),Y.graph.setDirtyCanvas(!1,!0),re(!0),setTimeout(()=>{re(!1)},3e3))}};if(!f||u.length===0)return e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"max-w-lg p-8 bg-white rounded-lg shadow-sm border border-blue-100 relative",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h3",{className:"text-base font-bold text-blue-800 mb-2",children:"GenLab"}),e.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-full text-blue-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Batch Test Parameter Pairs"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Select a node to batch test parameter pairs"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-indigo-100 p-2 rounded-full text-indigo-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"How To Use"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Click on any node in your workflow to start the parameter testing process"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"No node is currently selected"})})]})]})});if(R){const t=(k-1)*A,a=Math.min(t+A,B.length),o=B.slice(t,a),n=Math.ceil(B.length/A);return e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["All ",B.length," images have been generated."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),ue&&e.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"py-1",children:e.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:le,children:e.jsxs("div",{className:"bg-white rounded-lg p-2 max-w-4xl max-h-[90vh] relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-700 hover:text-gray-900 rounded-full hover:bg-gray-200 p-1",onClick:le,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"overflow-auto max-h-[calc(90vh-4rem)]",children:e.jsx("img",{src:he,alt:"Enlarged image",className:"max-w-full h-auto"})})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:o.map((s,l)=>{const i=t+l;return e.jsxs("div",{className:`relative rounded-lg overflow-hidden border ${T===i?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:r=>ke(i,r),children:[e.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:r=>Ce(s.url,r),children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:s.url,alt:`Generated image ${i+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white",children:Object.entries(s.params).filter(([r,c])=>r!=="nodeParams"&&typeof c!="object").map(([r,c])=>e.jsxs("div",{children:[r,": ",String(c)]},r))})]},i)})}),n>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-4 mb-4",children:[e.jsx("button",{onClick:s=>U(1,s),disabled:k===1,className:`px-2 py-1 rounded ${k===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M8.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L4.414 10l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})]})}),e.jsx("button",{onClick:s=>U(k-1,s),disabled:k===1,className:`px-2 py-1 rounded ${k===1?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"px-2 py-1 text-xs text-gray-800",children:["Page ",k," of ",n]}),e.jsx("button",{onClick:s=>U(k+1,s),disabled:k===n,className:`px-2 py-1 rounded ${k===n?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:s=>U(n,s),disabled:k===n,className:`px-2 py-1 rounded ${k===n?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M4.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L8.586 10 4.293 14.293a1 1 0 000 1.414z",clipRule:"evenodd"}),e.jsx("path",{fillRule:"evenodd",d:"M11.293 15.707a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-5-5a1 1 0 00-1.414 1.414L15.586 10l-4.293 4.293a1 1 0 000 1.414z",clipRule:"evenodd"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:s=>G(s),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:s=>Pe(s),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:T===null,children:"Apply Selected"})]})]})})}return V?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:e.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[e.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),e.jsxs("div",{className:"text-xs mb-3",children:["Completed ",J," of ",D," runs"]}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${J/D*100}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",J," images"]}),e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),De({clear:!0}),Ie(),P(!1),w(2)},className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",D," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),_&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:_})]})}),u.length>0?u.map((t,a)=>{const o=t.type||"Unknown Node",n=t.widgets||[],s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[o," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:n.map((l,i)=>{const r=l.name;if(!b[r])return null;const c=h[s]?.[r]||[],x=Array.isArray(c)?`[${c.join(", ")}]`:JSON.stringify(c);return e.jsxs("div",{className:i<n.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700",children:r}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:x,onClick:m=>m.preventDefault()})})]},i)})})]},a)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>G(t),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>oe(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Start Generation"})]})]})}):p===0?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select Parameters for Testing"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose the parameters you want to include in your batch test"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),u.map((t,a)=>{const o=t.title||"Unknown Node",n=t.widgets||[];return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:o}),e.jsx("div",{className:"p-4 space-y-3",children:e.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:n.map((s,l)=>{const i=s.name;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${b[i]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:r=>be(i,r),children:b[i]&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),e.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:i})]},`widget-${l}`)})})})]},`node-${a}`)}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:t=>ne(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})})]})}):p===1?e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Parameter Options"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:t=>w(0),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),u.length>0?u.map((t,a)=>{const o=t.widgets||{},n=Object.values(o),s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[t.type," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-4",children:n.map((l,i)=>{const r=l.name;if(!b[r])return null;const c=`${s}_${r}`;if(l.type==="number"){const x=l.options?.min||0,m=l.options?.max||100,d=(l.options?.step||10)/10,N=l.options?.precision||0,C=H(x,m,d,N),L=me[c]||{min:x.toString(),max:m.toString(),step:d.toString()};return(!h[s]||!h[s][r])&&(M(s,r,C),F(g=>({...g,[c]:L}))),e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[r,":"]}),e.jsx("div",{className:"w-4"})]}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:L.min,onClick:g=>{g.preventDefault(),g.stopPropagation()},onChange:g=>{g.preventDefault(),g.stopPropagation();const j=g.target.value;if(F(y=>({...y,[c]:{...y[c],min:j}})),j===""||!isNaN(parseFloat(j))){const y=j===""?0:parseFloat(j),E=parseFloat(L.max||m.toString()),W=parseFloat(L.step||d.toString()),z=H(y,E,W,N);M(s,r,z)}}}),e.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:L.max,onClick:g=>{g.preventDefault(),g.stopPropagation()},onChange:g=>{g.preventDefault(),g.stopPropagation();const j=g.target.value;if(F(y=>({...y,[c]:{...y[c],max:j}})),j===""||!isNaN(parseFloat(j))){const y=parseFloat(L.min||x.toString()),E=j===""?y:parseFloat(j),W=parseFloat(L.step||d.toString()),z=H(y,E,W,N);M(s,r,z)}}}),e.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),e.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:L.step,onClick:g=>{g.preventDefault(),g.stopPropagation()},onChange:g=>{g.preventDefault(),g.stopPropagation();const j=g.target.value;if(F(y=>({...y,[c]:{...y[c],step:j}})),j===""||!isNaN(parseFloat(j))&&parseFloat(j)>0){const y=parseFloat(L.min||x.toString()),E=parseFloat(L.max||m.toString()),W=j===""?1:parseFloat(j),z=H(y,E,W,N);M(s,r,z)}}})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(h[s]?.[r]||C).map((g,j)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:y=>{y.stopPropagation(),q(s,r,g,y)},children:[e.jsx("span",{children:g}),e.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},j))})]}),e.jsx("div",{className:"mt-1",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max (max 10 values)"})})]},i)}else if(l.type==="combo"){const x=l.options?.values||[],m=`${s}_${r}`;return(!h[s]||!h[s][r])&&M(s,r,x.slice(0,3)),e.jsxs("div",{className:"border-b pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700",children:r}),e.jsxs("div",{className:"relative dropdown-container",children:[e.jsxs("button",{className:"appearance-none border border-gray-300 rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700",onClick:d=>{d.preventDefault(),d.stopPropagation(),ve(s,r,d)},"data-dropdown":m,children:[e.jsx("span",{children:(h[s]?.[r]||[]).length>0?`${r}: ${(h[s]?.[r]||[]).length} selected`:`Select ${r}`}),e.jsx("div",{className:"ml-2",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),I[m]&&e.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof I[m]=="object"?`${I[m].y}px`:"0px",left:typeof I[m]=="object"?`${I[m].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[e.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:e.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:$[m]||"",onChange:d=>{d.preventDefault(),d.stopPropagation(),ye(s,r,d.target.value)},onClick:d=>{d.preventDefault(),d.stopPropagation()},autoFocus:!0})}),e.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:d=>{d.preventDefault(),d.stopPropagation();const N=x.filter(C=>!$[m]||C.toLowerCase().includes(($[m]||"").toLowerCase()));we(s,r,N)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${x.length>0&&(h[s]?.[r]||[]).length===x.length?"bg-blue-500 border-blue-500":(h[s]?.[r]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(h[s]?.[r]||[]).length>0&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"font-medium",children:x.length>0&&(h[s]?.[r]||[]).length===x.length?"Deselect All":"Select All"})]}),e.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[x.filter(d=>!$[m]||d.toLowerCase().includes(($[m]||"").toLowerCase())).map((d,N)=>e.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:C=>{C.preventDefault(),C.stopPropagation(),q(s,r,d,C)},children:[e.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(h[s]?.[r]||[]).includes(d)?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(h[s]?.[r]||[]).includes(d)&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:d})]},N)),x.filter(d=>!$[m]||d.toLowerCase().includes(($[m]||"").toLowerCase())).length===0&&e.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(h[s]?.[r]||[]).map((d,N)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[e.jsx("span",{children:d}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:C=>{C.preventDefault(),C.stopPropagation(),q(s,r,d,C)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},N)),e.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:d=>{d.preventDefault(),d.stopPropagation();const N=`${r}${(h[s]?.[r]||[]).length+1}`;M(s,r,[...h[s]?.[r]||[],N])},children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add"})]})]})]})]},i)}else return(!h[s]||!h[s][r])&&M(s,r,[`${r}1`,`${r}2`,`${r}3`]),e.jsxs("div",{className:"border-b pb-3",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("label",{className:"text-xs font-medium text-gray-700",children:r})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(h[s]?.[r]||[]).map((x,m)=>e.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[e.jsx("span",{children:x}),e.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:d=>{d.preventDefault(),d.stopPropagation(),q(s,r,x,d)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},m)),e.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:x=>{x.preventDefault(),x.stopPropagation();const m=`${r}${(h[s]?.[r]||[]).length+1}`;M(s,r,[...h[s]?.[r]||[],m])},children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"Add"})]})]})]})]},i)})})]},a)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>G(t),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>ne(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})}):e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",D," total runs. Each run will generate a separate image."]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:t=>w(0),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),_&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("div",{className:"ml-2",children:_})]})}),u.length>0?u.map((t,a)=>{const o=t.type||"Unknown Node",n=t.widgets||[],s=t.id;return e.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[o," (ID: ",s,")"]}),e.jsx("div",{className:"p-4 space-y-3",children:n.map((l,i)=>{const r=l.name;if(!b[r])return null;const c=h[s]?.[r]||[],x=Array.isArray(c)?`[${c.join(", ")}]`:JSON.stringify(c);return e.jsxs("div",{className:i<n.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[e.jsx("label",{className:"font-medium text-gray-700 text-xs",children:r}),e.jsx("div",{className:"flex space-x-2 items-center",children:e.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:x,onClick:m=>m.preventDefault()})})]},i)})})]},a)}):e.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:t=>G(t),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),e.jsx("button",{onClick:t=>oe(t),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Start Generation"})]})]})})};export{_e as ParameterDebugInterface};
